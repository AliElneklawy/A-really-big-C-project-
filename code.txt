#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
#include <conio.h>
#include <time.h>
#include <assert.h>
#include <wchar.h>
#define MAX 1000

/*struct books
{
    char bname[150];
    char bauthor[100];
    unsigned bpages,
             price,
             numavail;
    struct books* link;
};
struct books *head;*/

int set_password(char []);
int numofbooks(FILE *);
int searchauthor(FILE *);
int searchtitle(FILE *);
char * reset(char pass_reset[]);
int savepassword(char []);
int edit(FILE *);
int add();
void start();
int del(FILE *);
int abstract(FILE *, int *);
int game();
void startgame();
void delpass();

struct books{
    char bname[150];
    char bauthor[100];
    char *abstract;
    unsigned bpages,
             price,
             numavail;
} info[MAX];

int readbooks (void) {
    FILE *ptr = fopen("books info.txt", "r");
    if ( ! ptr) {
        perror ( "books info.txt");
        return 0;
    }
    int book = 0;
    int field = -1;
    int each = 0;
    int parse = 0;
    int ch = 0;

    info[0].bname[0] = 0;
    info[0].bauthor[0] = 0;
    info[0].bpages = 0;
    info[0].price = 0;
    info[0].numavail = 0;

    while ( EOF != ( ch = fgetc ( ptr))) {
       // printf("%c", ch);

        if ( '\n' == ch) {
            parse = 0;//end of line. no parsing
        }
        if ( parse) {
            if ( ! each && ( ' ' == ch || '\t' == ch)) {
                continue;//skip leading spaces
            }
            if ( 0 == field) {
                if ( each + 1 < 150) {
                    info[book].bname[each] = ch;
                    ++each;
                    info[book].bname[each] = 0;
                }
               // printf ( "name %s  ", info[book].bname);
            }
            if ( 1 == field) {
                if ( each + 1 < 100) {
                    info[book].bauthor[each] = ch;
                    ++each;
                    info[book].bauthor[each] = 0;
                }
               // printf ( "author %s  ", info[book].bauthor);
            }
            if ( 2 == field) {
                info[book].bpages *= 10;
                info[book].bpages += ch - '0';
            }
            if ( 3 == field) {
                info[book].price *= 10;
                info[book].price += ch - '0';
            }
            if ( 4 == field) {
                info[book].numavail *= 10;
                info[book].numavail += ch - '0';
            }
        }
        if ( ':' == ch) {
            ++field;
            if ( 5 == field) {
                field = 0;
                if ( book + 1 < MAX) {
                    ++book;
                    info[book].bname[0] = 0;
                    info[book].bauthor[0] = 0;
                    info[book].bpages = 0;
                    info[book].price = 0;
                    info[book].numavail = 0;
                }
            }
            each = 0;
            parse = 1;//resume parsing
        }
    }
    fclose ( ptr);
    if (4 == field) {
        ++book;
    }
    return book;
}

/*void clock()
{
    int h = 2, m = 41, s = 12;
    int d = 1000;


    while(1){
        s++;
        if (s > 59){
            m++;
            s = 0;
        }
        if (m > 59){
            h++;
            m = 0;
        }
        if(h>12){
            h = 1;
        }

        printf("%02d : %02d : %02d", h, m, s);
        Sleep(d);
        system("cls");
        //menu();

    }
    printf("\n\n");

}*/

void startgame()
{
    system("color 04");
    char start[11] = " GOOD LUCK";

    printf("\n\n\n\n\n\n\n                 ");
    for (int i = 1; i < 20; i++) {
        printf("*");
        Sleep(50);
    }
    for (int i = 0; i < 11; i++) {
        printf("%c", start[i]);
        Sleep(50);
    }
    for (int i = 1; i < 20; i++) {
        printf("*");
        Sleep(50);
    }
    Sleep(1000);
    system("cls");

}

void start()
{

         system("color 04");
         char start[8] = "WELCOME";

         printf("\n\n\n\n\n\n\n                 ");
         Sleep(500);
         for (int as = 1; as < 20; as++) {
            Sleep(50);
            printf("-");
         }
         printf(">");
         printf(" ");

         for (int as = 0; as < 9; as++) {
            Sleep(50);
            printf("%c", start[as]);
         }
         printf("\b");

         printf("<");
         for (int as = 1; as < 20; as++) {
            Sleep(50);
            printf("-");
         }
         Sleep(1000);
         system("cls");

         return;
}



int wmain(void) {

    time_t t;
    t = time(NULL);
    struct tm tm = *localtime(&t);
    int m;
    printf(" %d ", tm.tm_mday);
    m = tm.tm_mon+1;
    switch(m)
    {
        case 1:
            printf("Jan, ");
            break;
        case 2:
            printf("Feb, ");
            break;
        case 3:
            printf("Mar, ");
            break;
        case 4:
            printf("Apr, ");
            break;
        case 5:
            printf("May, ");
            break;
        case 6:
            printf("June, ");
            break;
        case 7:
            printf("July, ");
            break;
        case 8:
            printf("Aug, ");
            break;
        case 9:
            printf("Sep, ");
            break;
        case 10:
            printf("Oct, ");
            break;
        case 11:
            printf("Nov, ");
            break;
        case 12:
            printf("Dec, ");
            break;
    }
    printf("%d", tm.tm_year+1900);
    printf("\n ");
    if(tm.tm_hour>=12)
    {
        if(tm.tm_hour==12)
            printf("12");
        else
            printf("%d", tm.tm_hour-12);
        printf(":%d PM\n", tm.tm_min);
    }
    else
        printf("%d:%d AM", tm.tm_hour, tm.tm_min);
    //getch();
    return 0;
}

int menu()
{

    system("color 06");
    int n;
    wmain();
    printf("\n              Welcome to our book store.... \n\n\n");
    printf(" [1]. Add a book.\n [2]. Display books available.\n [3]. Search by author.\n [4]. Search by book title.\n [5]. Show number of books we have.\n [6]. Set password\n [7]. Edit the library\n [8]. Delete a book.\n [9]. Add an abstract.\n [10] Golden millionare game.\n [11] Exit\n\n");
    printf("Choose a number: ");      scanf("%d", &n);
    return n;

}


int main()
{
    start();
    system("color 03");
    unsigned n,
             trials = 0,
             btrials = 3;
    int i = 0,
        re;

    FILE *ptr,
         *pw,
         *first;

    char ch,
         decide,
         de,
         de2,
         fi,
         pass_set [MAX],
         pass_set2[MAX],
         pass_in [MAX];     //used to store the password from the user

   pass:
    first = fopen("d.dat", "r");
    fi = fgetc(first);
    if (fi == 'b') {
        goto start;
    }
    else {
        label:

            printf("\n\n\n\n\n\n                                 Enter the password: ");
            pw = fopen("a.txt", "rb");
            fread (pass_set2, sizeof (pass_set2), 1, pw);

            pass_in[i] = getch();
            while ( pass_in[i] != '\r') {

                if( pass_in[i] == 27 ) {
                     system("cls");
                     exit(EXIT_SUCCESS);
                     }

                else if (pass_in[i] == '\b')
                {
                   if (i > 0) {
                        --i;
                        printf("\b");
                        printf(" ");
                        printf("\b");
                        pass_in[i] = getch();
                        /*if (i <= 0) {
                            pass_in[i] = getch();
                        }*/
                   } else if (i <= 0) {
                        pass_in[i] = getch();
                    }
                } else {
                    printf("*");
                    i++;
                    pass_in[i] = getch();
                  }
                //pass_in[i] = ch2;
                //printf("*");
                //i++;
            }
            pass_in[i] = '\0';
            i = 0;
            if(strcmp(pass_in, pass_set2) == 0){
                system("cls");
                printf("\n\n\n\n\n\n\n\n\n                                      CHECKING");
                for(i = 0; i <= 5; i++){
                    Sleep(20);
                    printf(".");
                }
                system("cls");
                printf("\n\n\n\n\n\n\n\n\n                                      WELCOME");
                for(i = 0; i <= 5; i++){
                    Sleep(20);
                    printf(".");
                }
                system("cls");
                goto start;  //line 111
            }
            else {
                fflush(stdin);
                printf("\n\n                      Invalid password.");
                trials++;
                printf("\n\n                      You have %u trials left.", btrials--);

                if (trials == 4) {
                    system("cls");
                    btrials = 3;
                    trials = 0;
                    for (int d = 30; d > -1; d--) {
                        printf("\n\n                      Retry in %d seconds.", d);
                        Sleep(1000);
                        system("cls");
                    }
                }

                label3:
                    printf("\n\n                      Press 't' to try again or 'e' to exit.\n\n");
                    de = getch();
                    //scanf("%c", &answer);
                    if ((de == 't') || (de == 'T')){
                        system("cls");
                        goto label;  //line 53
                    }

                    else if ( (de == 'e') || (de == 'E'))     { exit(0); }

                    else {
                        system("cls");
                        printf("\n\n                      Please, enter a valid value");
                        goto label3;  //line 93
                        }
                    }
    }

      //struct books *head = malloc(sizeof(struct books));

    start:
      n = menu();
      switch(n){

        case 1:

            re = add();
            if (re == 2) {
               goto start;
            }
            break;

       case 2:
           system("cls");
           ptr = fopen("books info.txt", "r");
           printf("\n\n                     Here are all the books we have in the library.....\n\n\n");
           printf("Total (%d) books are available:-\n\n", numofbooks(ptr));
           ptr = freopen("books info.txt", "r", ptr);
           ch = fgetc(ptr);
           while (ch != EOF){
                printf("%c", ch);
                ch = fgetc(ptr);
           }

           label2:
                fflush(stdin);
                printf("\n\npress 'm' to go to main menu or 'e' to exit. \n\n\n");
                decide = getch();
                //scanf("%c", &ans);
                if (decide == 'm' || decide == 'M'){
                    system("cls");
                    goto start;
                }
                else if(decide == 'e' || decide == 'E'){
                    system("cls");
                    printf("\n\n        See you soon");
                    for(i = 1; i <= 7; i++){
                        Sleep(200);
                        printf(".");
                    }
                    printf("\n\n\n\n");
                    exit(0);
                }
                else {
                    system("cls");
                    printf("\n\nPlease, enter a valid value.");
                    goto label2;    //line 164
                }

           break;

       case 3:
           system("cls");
        research:
           re = searchauthor(ptr);
           if (re == 1) {
                goto start;
           }

           else if (re == 2) {
                goto research;
           }

           break;

       case 4:
        system("cls");
      research2:
        re = searchtitle(ptr);
        if (re == 1) {
                goto start;
           }

           else if (re == 2) {
                goto research2;
           }
        break;

       case 5:
           system("cls");
           ptr = fopen("books info.txt", "r");
           if (ptr == NULL)    { printf("Couldn't open the file....");     exit(1); }
           int numberofbooks = numofbooks(ptr);
           printf("\n\n     Total (%d) books are available in the library. ", numberofbooks);
           label4:
               printf("\n\n\n\nPress 'm' to go to main menu or 'e' to exit. ");
               de2 = getch();
               if(de2 == 'm' || de2 == 'M'){
                    system("cls");
                    goto start;
               }
               else if(de2 == 'e' || de2 == 'E'){
                    system("cls");
                    printf("GOODBYE");
                    for (i = 1; i <= 6; i++){
                        Sleep(200);
                        printf(".");
                    }
                    printf("\n\n\n");
                    exit(1);
               }
               else{
                printf("\n\nPlease, enter a valid value.\n");
                goto label4;    //line 200
               }
           i = 0;
           break;

       case 6:
           system("cls");
           re = set_password(pass_set);
           if (re == 5) {
              system("cls");
              goto start;
              break;
           }
           else {
              /* for (i=0; i < 100; i++){
                printf("%c", pass_set[i]);
               }
               i = 0;*/
               for (i = 0; i < 90; i++){
                pass_set2[i] = pass_set[i];
               }
              // i = 0;

               /*for (i=0; i < 100; i++){
                printf("%c", pass_set2[i]);
               }
               i = 0;*/


               //FILE *pw;
             label12:
               pw = fopen("a.txt", "wb");
               if(pw == NULL) {
                    printf("Can't open the file. Try again.");
                    goto label12;
               }
               else{
                fwrite(pass_set2, sizeof(char), sizeof(pass_set2), pw);
               }
               fclose(pw);
               pw = freopen("a.txt", "rb", pw);
               fgets(pass_set2, i, pw);
               /*for(j = 0; j < i; j++){
                printf("%c", pass_set2[j]);
               }*/
               fclose(pw);

               printf("\n   You will be asked to enter your new password again\n\n");
               for(i = 0; i <= 5; i++){
                    Sleep(500);
                    printf(".");
               }
               system("cls");
               main();
               //goto label;
               break;
           }

       case 7:
           system("cls");
      research3:
        re = edit(ptr);
        if (re == 1) {
                goto start;
           }

           else if (re == 2) {
                goto research3;
           }
           break;

       case 8:
            system("cls");
        del2:
            //fclose(ptr);
            re = del(ptr);
            if (re == 1) {
                goto del2;
            }

            else if (re == 2) {
                goto start;
            }
            break;

       /*case 9:
           system("cls");
         go:
           re = abstract(ptr);
           if (re == 1) {
            goto go;
           }

           break;*/

       case 10:
           system("cls");
         again:
           re = game();
           if (re == 1) {
            goto again;
           }
           else if (re == 2) {
            goto start;
           }
           break;

       case 11:
           system("cls");
           printf("\n\n\n\n\n\n\n\n\n                  GOODBYE");
           for (i = 1; i <= 6; i++){
              Sleep(100);
              printf(".");
           }
           printf("\n\n\n");
           break;
        }
}

int add()
{
    system("cls");
    int ans = 1;
    char line[100] = "";
    int p, re;
    char ch;

    //printf("%d", p);
    FILE *ptr = fopen("books info.txt", "a");
    p = readbooks();
    if ( ! ptr) {
        perror ( "books info.txt");
        return 0;
    }
    while(ans == 1) {

        fflush(stdin);
        printf("\nEnter The name of the book: ");
        fgets(info[p].bname, 150, stdin);
        info[p].bname[strcspn ( info[p].bname, "\n")] = 0;
        fprintf(ptr, "Book name: %s\n", info[p].bname);
        fflush(stdin);

        printf("Enter The author of this book: ");
        fgets(info[p].bauthor, 100, stdin);
        info[p].bauthor[strcspn ( info[p].bauthor, "\n")] = 0;
        fprintf(ptr, "Book author: %s\n", info[p].bauthor);

        printf("Enter The number of pages of this book: ");
        fgets ( line, 100, stdin);
        sscanf(line, "%u", &info[p].bpages);
        fprintf(ptr, "Number of pages: %u\n", info[p].bpages);

        printf("What is the price of the book (in EGP)? ");
        fgets ( line, 100, stdin);
        sscanf( line, "%u", &info[p].price);
        fprintf(ptr, "Price (in EGP): %u\n", info[p].price);

        printf("Number of books available: ");
        fgets ( line, 100, stdin);
        sscanf( line, "%u", &info[p].numavail);
        fprintf(ptr, "Number of books available: %u", info[p].numavail);

        /*printf("\nAdd an abstract:-\n   ");
        fgets ( line, 600, stdin);
        sscanf( line, "%s", &info[p].abstract);
        fprintf(ptr, "\nAbstract: %s", info[p].abstract);*/
        ++p;

        fprintf(ptr, "\n---------------------------------------------------------\n");
        printf("\nBook information saved successfully....\n");

      label:
        printf("\nEnter    (1) to add another book\nor       (2) for main menu. ");
        fgets ( line, 100, stdin);
        sscanf( line, "%d", &ans);
        if (ans == 2)       {
            system("cls");
            fclose(ptr);
            return 2;
        }
        else if (ans == 1) {
            continue;
        }
        else {
            printf("\n Please enter a valid value.");
            goto label;
        }
    }


    return p;

}

int abstract(FILE *ptr, int *p)
{
    unsigned i = 0,
             save,
             flag = 1,
             bookindex,
             len,
             wrd = 0;
    char ch,
         de1,
         abst[600];

    fgets(abst, 600, stdin);
    for (i = 0; i < 600; i++) {
        if (abst[i] == ' ') {
            wrd++;
        }
    }
    abst[i] == '\0';
    //printf("%u", wrd - 1);
    if ((wrd - 1) > 150){
        printf("\n\n Abstract is too long. Please write a shorter one.");
        abst[600] = reset(abst);
       // fclose(ptr);
        return 1;
    }
    else {
        sscanf( abst, "%s", &info[*p].abstract);
        fprintf(ptr, "\nAbstract: %s", info[*p].abstract);
        return;
    }

}


int numofbooks(FILE *ptr)
{
    int ch;
    int num = 0, keep;
    ch = fgetc(ptr);
    while(ch != EOF){
       if(ch == ':'){
            num++;
        }
    ch = fgetc(ptr);
    }

    return num / 5;
}

int searchauthor(FILE *ptr)
{
    int save;
    char de;
    char in_name[30];
    int flag = 1;

    save = readbooks();
    ptr = fopen("books info.txt", "r");
    fflush(stdin);
    printf("\n Enter the name of the author: ");
    gets(in_name);
    printf("-------------------------------------------------");

    for(int i = 0; i < save; i++){
        if(strcmpi(in_name, info[i].bauthor) == 0){
            printf("\n Book name: %s\n Price: %u\n Number of books available: %u\n Number of pages: %u\n-------------------------------------------------", info[i].bname, info[i].price, info[i].numavail, info[i].bpages);
            flag = 0;
        }
    }

    if (flag == 1){
        printf("\n Not found.\n Do you want to try another search [Y/N]? ");
        scanf("%c", &de);
        if(de == 'y' || de == 'Y'){
            system("cls");
            in_name[MAX] = reset(in_name);
            fclose(ptr);
            return 2;
        }
        else if(de == 'n' || de == 'N'){
            printf("\n You will be redirected to main menu");
            for(int k = 1; k <= 5; k++){
                Sleep(300);
                printf(".");
            }
            system("cls");
            return 1;
        }
    }

    printf("\n\n Do you want to try another search [Y/N]? ");
    scanf("%c", &de);

    if (de == 'y' || de == 'Y') {
        system("cls");
        in_name[MAX] = reset(in_name);
        return 2;       //return 2 to case 3 to search again
    }
    else if (de == 'n' || de == 'N') {
        system("cls");
        printf("\n You will be redirected to main menu");
        for(int k = 1; k <= 5; k++){
            Sleep(300);
            printf(".");
        }
        system("cls");
        return 1;
    }

  /*back:
    printf("\n\n");
    printf("\n      ---------------------");
    printf("\n     |Press 'q' to go back | \n");
    printf("      ---------------------");
    de = getch();
    if (de == 'q' || de == 'Q') {
        system("cls");
        return 1;
    }
    else {
        printf("\n     Please, enter a valid value.");
        goto back;
    }*/

    printf("\n\n");
}


int searchtitle(FILE *ptr)
{
    int save;
    char de;
    char in_title[40];
    int flag = 1;

    save = readbooks();
    ptr = fopen("books info.txt", "r");
    fflush(stdin);
    printf("\n Enter the name of the book: ");
    gets(in_title);
    printf("-------------------------------------------------");

    for(int i = 0; i < save; i++){
        if(strcmpi(in_title, info[i].bname) == 0){
            printf("\n Book name: %s\n Books author: %s\n Price:  %u\n Number of books available: %u\n Number of pages: %u\n-------------------------------------------------", info[i].bname, info[i].bauthor, info[i].price, info[i].numavail, info[i].bpages);
            flag = 0;
        }
    }

    if (flag == 1) {
        printf("\n Not found.\n Do you want to try another search [Y/N]? ");
        scanf("%c", &de);
        if(de == 'y' || de == 'Y') {
            system("cls");
            in_title[40] = reset(in_title);
            fclose(ptr);
            return 2;
        }
        else if(de == 'n' || de == 'N') {
            printf("\n You will be redirected to main menu");
            for(int k = 1; k <= 5; k++){
                Sleep(300);
                printf(".");
            }
            system("cls");
            return 1;
        }
    }

    printf("\n\n Do you want to try another search [Y/N]? ");
    scanf("%c", &de);

    if (de == 'y' || de == 'Y') {
        system("cls");
        in_title[MAX] = reset(in_title);
        return 2;       //return 2 to case 4 to search title again
    }
    else if (de == 'n' || de == 'N') {
        system("cls");
        printf("\n You will be redirected to main menu");
        for(int k = 1; k <= 5; k++){
            Sleep(300);
            printf(".");
        }
        system("cls");
        return 1;
    }

    printf("\n\n");
}



int set_password(char pass_set[])
{
    int chh;

    printf("\n\n [1]. Edit password\n [2]. Delete password");
    printf("\n\n Your choice: ");
    scanf("%d", &chh);

    if (chh == 2) {
        FILE *first = fopen("d.dat", "w");
        fprintf(first, "b");
        fclose(first);
        printf("\n Password is deleted successfuly");
        for (int i = 1; i < 5; i++) {
            printf(".");
            Sleep(500);
        }
        return 5;
    }
    else {
        char pass_set2[MAX],
             ch,
             ch2,
             pass_set3[MAX],
             pass_set1[MAX],
             pass_set4[MAX];

        int i = 0,
            i2 = 0,
            len;

      label9:
        printf("\n\n    Please, enter a new password:  ");

        pass_set[i] = getch();
        while ( pass_set[i] != '\r') {

            if( pass_set[i] == 27 ) {
                system("cls");
                exit(EXIT_SUCCESS);
            }

            else if (pass_set[i] == '\b')
            {
                if (i > 0) {
                    --i;
                    printf("\b");
                    printf(" ");
                    printf("\b");
                    pass_set[i] = getch();
                        /*if (i <= 0) {
                            pass_in[i] = getch();
                        }*/
                } else if (i <= 0) {
                    pass_set[i] = getch();
                  }
                } else {
                    printf("*");
                    i++;
                    pass_set[i] = getch();
                  }
            }

        pass_set[i] = '\0';     //password input ends here

        /*len = strlen(pass_set);
        if (len < 6) {
            system("cls");
            printf("\n     Password is too short.");
            pass_set[MAX] = reset(pass_set);
            return 1;
        }*/

        i = 0;
        printf("\n\n    Please, confirm your password: ");

        pass_set3[i] = getch();
        while ( pass_set3[i] != '\r') {

            if ( pass_set3[i] == 27 ) {
                system("cls");
                exit(EXIT_SUCCESS);
            }

            else if (pass_set3[i] == '\b')
            {
                if (i > 0) {
                    --i;
                    printf("\b");
                    printf(" ");
                    printf("\b");
                    pass_set3[i] = getch();
                        /*if (i <= 0) {
                            pass_in[i] = getch();
                        }*/
                } else if (i <= 0) {
                    pass_set3[i] = getch();
                  }
                } else {
                    printf("*");
                    i++;
                    pass_set3[i] = getch();
                  }
            }

        pass_set3[i] = '\0';
        system("cls");                  //password confirmation ends here

        if (strcmp(pass_set, pass_set3)  != 0) {
            system("cls");
            printf("\n    Passwords don't match. Please, try again.");
            pass_set[MAX] = reset(pass_set);
            pass_set3[MAX] = reset(pass_set3);
            set_password(pass_set);
        }
        else {
            printf("\n\n    Your new passord is: ");
            for(int j2 = 0; j2 < i; j2++){
                printf("%c",  pass_set[j2]);
            }
                printf("\n    Please, memorize it.\n\n\n\n");
        }

           FILE *first = fopen("d.dat", "w");
           fprintf(first, "a");
           fclose(first);
           return pass_set;
           savepassword(pass_set);
        }
}

char * reset(char pass_reset[])
{
    memset(pass_reset, 0, sizeof(pass_reset)/sizeof(pass_reset[0]));

    return pass_reset;
}

int savepassword(char pass_save[])         //pass_save = pass_set3 from main
{

       return pass_save;
}


int edit(FILE *ptr)
{
    system("cls");

    ptr = fopen("books info.txt", "r");

    char edbook[40],
         de,
         ch,
         newname[40],
         newauthor[30];
    int save,
        flag = 1,
        i,
        bookindex,
        newprice,
        newnumavail,
        check,
        newpages;
    save = readbooks();
    fflush(stdin);

    printf("\n Enter The name of the book to edit: ");
    gets(edbook);

    for (i = 0; i < save; i++){
        if(strcmpi(edbook, info[i].bname) == 0){
            printf("\n Here is the book you want to edit: ");
            printf("\n-------------------------------------------------");
            printf("\n Book name: %s\n Books author: %s\n Price:  %u\n Number of books available: %u\n Number of pages: %u\n-------------------------------------------------", info[i].bname, info[i].bauthor, info[i].price, info[i].numavail, info[i].bpages);
            //fprintf(temp, " Book name: %s\n Books author: %s\n Price:  %u\n Number of books available: %u\n Number of pages: %u", info[i].bname, info[i].bauthor, info[i].price, info[i].numavail, info[i].bpages);
            flag = 0;
            //printf("%d", i);
            bookindex = i;
        }
    }


    if (flag == 1) {
        printf("\n Not found.\n Do you want to try another search [Y/N]? ");
        scanf("%c", &de);
        if(de == 'y' || de == 'Y') {
            system("cls");
            edbook[40] = reset(edbook);
            fclose(ptr);
            return 2;
        }
    else if (de == 'n' || de == 'N') {
        printf("\n You will be redirected to main menu");
        for(int k = 1; k <= 5; k++){
            Sleep(300);
            printf(".");
        }
        system("cls");
        return 1;
        }
    }
    printf("\n\n");

    freopen("books info.txt", "w", ptr);
    printf("\n Enter the new name of the book: ");
    gets(info[bookindex].bname);
    fprintf(ptr, "Book name: %s", info[bookindex].bname);

    printf("\n Enter the new author of the book: ");
    gets(info[bookindex].bauthor);
    fprintf(ptr, "\nBook author: %s\n", info[bookindex].bauthor);

    printf("\n Enter the new number of pages: ");
    scanf("%u", &info[bookindex].bpages);
    fprintf(ptr, "Number of pages: %u\n", info[bookindex].bpages);

    printf("\n Enter the new price: ");
    scanf("%u", &info[bookindex].price);
    fprintf(ptr, "Price: %u\n", info[bookindex].price);

    printf("\n Enter the number of the available books: ");
    scanf("%u", &info[bookindex].numavail);
    fprintf(ptr, "Number of books available: %u", info[bookindex].numavail);
    fprintf(ptr, "\n---------------------------------------------------------\n");

    freopen("books info.txt", "a", ptr);
    for (i = 0; i < save; i++) {
        if (i == bookindex) {
            continue;
        }
        else {
        fprintf(ptr, "Book name: %s\nBook author: %s\nNumber of pages: %u\nPrice: %u\nNumber of books available: %u\n---------------------------------------------------------\n", info[i].bname, info[i].bauthor, info[i].bpages, info[i].price, info[i].numavail);
        }
    }
    fclose(ptr);

  retry:
    printf("\n Do you want to edit another book [Y/N]? ");
    de = getch();

    if (de == 'y' || de == 'Y') {
        system("cls");
        edbook[40] = reset(edbook);
        return 2;
    }
    else if (de == 'n' || de == 'N') {
        system("cls");
        printf("\n You will be redirected to main menu");
        for (int j = 1; j < 4; j++) {
            Sleep(200);
            printf(".");
        }
        system("cls");
        return 1;
    }
    else {
        printf("\n Please enter a valid value.\n");
        goto retry;
    }
}

int del(FILE *ptr)
{
    char delbook[41],
         de,
         de1;
    unsigned save,
        bookindex,
        flag = 1;
    FILE *temp;

    save = readbooks();
    ptr = fopen("books info.txt", "r");

    //printf("%d", save);
    fflush(stdin);

    printf("\n Enter the name of the book to delete: ");
    gets(delbook);

    for (int i = 0; i < save; i++) {
        if (strcmpi(delbook, info[i].bname) == 0) {
            printf("\n Here is the book you want to delete\n ---------------------------------------------------------");
            printf("\n Book name: %s\n Books author: %s\n Price:  %u\n Number of books available: %u\n Number of pages: %u\n -------------------------------------------------", info[i].bname, info[i].bauthor, info[i].price, info[i].numavail, info[i].bpages);
            bookindex = i;
            flag = 0;
        }
    }

    if (flag == 0) {
        printf("\n Are you sure you want to delete this book (Press (y) for yes, (n) for no)? ");
        de1 = getch();
        if (de1 == 'y' || de1 == 'Y') {
            fclose(ptr);
            ptr = fopen("books info.txt", "w");
            ptr = freopen("books info.txt", "a", ptr);
            for (int cpy = 0; cpy < save; cpy++) {
                if (cpy == bookindex) {
                    continue;
                }

                else {
                    fprintf(ptr, "Book name: %s\nBook author: %s\nNumber of pages: %u\nPrice: %u\nNumber of books available: %u\n---------------------------------------------------------\n", info[cpy].bname, info[cpy].bauthor, info[cpy].bpages, info[cpy].price, info[cpy].numavail);
                }

            }
            fclose(ptr);
            printf("\n\n Book deleted successfully!\n");
        }
    }


    else if (flag == 1) {
        printf(" Not found.");
      retry1:
        printf("\n Do you want to try another search [Y/N]? ");
        de1 = getch();
        if (de1 == 'Y' || de1 == 'y') {
            system("cls");
            delbook [41] = reset(delbook);
            return 1;
        }
        else if (de1 == 'n' || de1 == 'N') {
            system("cls");
            return 2;
        }

        else {
            printf("\n Please, enter a valid value.");
            system("cls");
            goto retry1;  //line 1119
        }
    }

  retry:
    printf("\n\n Do you want to delete another book [Y/N]? ");
    scanf("%c", &de);

    if (de == 'y' || de == 'Y') {
        system("cls");
        return 1;
    }

    else if (de == 'n' || de == 'N') {
        system("cls");
        return 2;
    }

    else {
        printf("\n Please, enter a valid value.");
        system("cls");
        goto retry;  //line 1119
    }
}


int game()
{
    startgame();
    system("color 07");
    char q[1000],
         answers_cap[20] = {'C', 'A', 'A', 'B', 'C', 'D', 'B', 'A', 'B', 'D', 'A', 'D', 'C', 'A'},
         answers_sml[20] = {'c', 'a', 'a', 'b', 'c', 'd', 'b', 'a', 'b', 'd', 'a', 'd', 'c', 'a'},
         ch,
         ans,
         de;
        // i = 0;
    unsigned crr = 0,
             wrng = 0,
             i = 0,
             score = 0;

    FILE *game;
    game = fopen("game.dat", "r");

    if (game == NULL) {
        perror("game.dat");
    }

   cont:
    printf("\n\n");
    fgets(q, 120, game);
    printf("    %s", q);
    fgets(q, 120, game);
    printf("    %s", q);
    fgets(q, 120, game);
    printf("    %s", q);
    fflush(stdin);

    printf("\n\n      ANSWER: ");
    ans = getchar();

    if (ans == answers_cap[i] || ans == answers_sml[i]) {
        crr++;
        i++;
        if (score == 0) {
            score = 1000;
        }
        else {
            score += score;
        }
    }
    else {
        wrng++;
    }

    while (!feof(game)) {
        system("cls");
        goto cont;
    }

    printf("\n\n You have scored %d correct answers and %d wrong answers\n", crr, wrng);
    //printf("\nYour score is %d\n\n", score);

   re:
    printf("Press 'a' to play again or 'm' for main menu\n");
    de = getch();

    if (de == 'a') {
        system("cls");
        return 1;
    }
    else if (de == 'm') {
        system("cls");
        return 2;
    }
    else {
        printf("\n Enter a valid value.\n\n");
        goto re;
    }
}

